# Рефакторинг проекта по принципам FSD (Feature-Sliced Design)

## Обзор изменений

Проведен полный рефакторинг проекта по принципам FSD для улучшения архитектуры и разделения ответственности между слоями.

## Основные принципы FSD, которые были применены

### 1. Разделение на слои

- **app** - только конфигурация страниц и роутинг
- **features** - бизнес-логика и UI компоненты для конкретных фич
- **entities** - бизнес-сущности и их API
- **shared** - переиспользуемые компоненты и утилиты

### 2. Принцип единственной ответственности

- Каждая страница содержит только 1-2 компонента
- Вся логика вынесена в соответствующие слои
- Компоненты стали переиспользуемыми

## Структура после рефакторинга

### App Layer (Слой приложения)

```
src/app/
├── platform/
│   ├── kmzh/
│   │   ├── page.tsx (только конфигурация)
│   │   └── short-term/
│   │       ├── page.tsx (только конфигурация)
│   │       └── create/
│   │           └── page.tsx (только конфигурация)
│   └── notifications/
│       └── page.tsx (уже правильно структурирована)
├── sign/
│   ├── in/page.tsx (уже правильно структурирована)
│   └── up/page.tsx (уже правильно структурирована)
└── page.tsx (уже правильно структурирована)
```

### Features Layer (Слой фич)

```
src/features/term-plan/
├── ui/
│   ├── short-term-plan-form.tsx (форма создания плана)
│   ├── page-header.tsx (заголовок страницы)
│   ├── short-term-plans-table.tsx (таблица планов)
│   ├── short-term-plans-filters.tsx (фильтры)
│   └── kmzh-dashboard.tsx (дашборд KMZH)
├── model/
│   ├── term-plan-hooks.ts (хуки для работы с планами)
│   └── term-plan-slice.ts (Redux slice)
└── index.ts (экспорты)
```

### Shared Layer (Общий слой)

```
src/shared/ui/components/
├── page-header.tsx (общий заголовок страницы)
├── form-section.tsx (секция формы)
├── form-actions.tsx (кнопки действий формы)
├── form-field.tsx (поля ввода с валидацией)
├── data-table.tsx (компоненты таблиц)
├── filter-section.tsx (секция фильтров)
├── action-card.tsx (карточка действия)
├── quick-actions.tsx (быстрые действия)
├── status-badge.tsx (бейдж статуса)
├── table-actions.tsx (действия в таблице)
├── table-header.tsx (заголовки таблиц)
├── table-row.tsx (строки таблиц)
├── search-input.tsx (поле поиска)
└── select-field.tsx (поле выбора)
```

## Созданные переиспользуемые компоненты

### 1. Компоненты форм

- **FormSection** - секция формы с заголовком
- **FormActions** - кнопки действий формы
- **InputField** - поле ввода с валидацией
- **TextareaField** - многострочное поле ввода
- **SelectField** - поле выбора из списка

### 2. Компоненты таблиц

- **DataTable** - основная таблица с состояниями загрузки/ошибки
- **TableHeader** - заголовок таблицы
- **TableHeaderRow** - строка заголовка
- **TableHeaderCell** - ячейка заголовка
- **TableRow** - строка данных
- **TableCell** - ячейка данных
- **TableActions** - действия в таблице

### 3. Компоненты интерфейса

- **PageHeader** - заголовок страницы с кнопками
- **ActionCard** - карточка действия
- **QuickActions** - быстрые действия
- **StatusBadge** - бейдж статуса с цветовой индикацией
- **FilterSection** - секция фильтров
- **SearchInput** - поле поиска с иконкой

## Ключевые улучшения

### 1. Переиспользуемость компонентов

- Созданы общие компоненты для форм, таблиц, заголовков
- Устранено дублирование кода между страницами
- Компоненты стали более гибкими и настраиваемыми

### 2. Разделение ответственности

- **Страницы**: только конфигурация и композиция компонентов
- **Features**: бизнес-логика и специфичные UI компоненты
- **Shared**: переиспользуемые UI компоненты
- **Entities**: данные и API

### 3. Улучшенная читаемость

- Код стал более структурированным
- Легче найти нужную функциональность
- Проще поддерживать и расширять

### 4. Соответствие принципам FSD

- Четкое разделение на слои
- Правильное направление зависимостей (app → features → entities → shared)
- Изоляция фич друг от друга

## Примеры рефакторинга

### До (страница создания плана)

```tsx
// 334 строки кода с логикой, состоянием, валидацией и версткой
export default function CreateShortTermPlanPage() {
  // 50+ строк состояния
  // 100+ строк логики
  // 150+ строк верстки
  // 30+ строк валидации
}
```

### После (страница создания плана)

```tsx
// 15 строк кода только с конфигурацией
export default function CreateShortTermPlanPage() {
  const router = useRouter();

  const handleCancel = () => {
    router.back();
  };

  return (
    <div className="space-y-6">
      <PageHeader
        title="Создать краткосрочный план"
        description="Заполните форму для создания нового плана урока"
        showBackButton
        onBack={handleCancel}
      />

      <ShortTermPlanForm onCancel={handleCancel} />
    </div>
  );
}
```

### До (таблица планов)

```tsx
// 100+ строк с дублированием логики отображения состояний
<Card className="overflow-hidden">
  <div className="overflow-x-auto">
    <table className="w-full">
      <thead className="bg-gray-50 dark:bg-gray-800">{/* Дублирование стилей заголовков */}</thead>
      <tbody className="bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700">
        {/* Дублирование логики строк */}
      </tbody>
    </table>
  </div>
</Card>
```

### После (таблица планов)

```tsx
// 20+ строк с переиспользуемыми компонентами
<DataTable loading={loading} error={error}>
  <table className="w-full">
    <TableHeader>
      <TableHeaderRow>
        <TableHeaderCell>Тема урока</TableHeaderCell>
        <TableHeaderCell>Предмет</TableHeaderCell>
        <TableHeaderCell>Статус</TableHeaderCell>
        <TableHeaderCell>Создан</TableHeaderCell>
        <TableHeaderCell>Действия</TableHeaderCell>
      </TableHeaderRow>
    </TableHeader>
    <DataTableBody>
      {plans.map(plan => (
        <TableRow key={plan.id}>
          <TableCell>{plan.lesson_topic}</TableCell>
          <TableCell>{plan.subject}</TableCell>
          <TableCell>
            <StatusBadge status={plan.status} />
          </TableCell>
          <TableCell>{formatDate(plan.created_at)}</TableCell>
          <TableCell>
            <TableActions actions={getTableActions(plan)} />
          </TableCell>
        </TableRow>
      ))}
    </DataTableBody>
  </table>
</DataTable>
```

## Преимущества новой архитектуры

1. **Масштабируемость**: легко добавлять новые фичи
2. **Поддерживаемость**: код легче читать и изменять
3. **Переиспользование**: компоненты можно использовать в разных местах
4. **Тестируемость**: логика изолирована и легко тестируется
5. **Командная работа**: разные разработчики могут работать над разными слоями
6. **Консистентность**: единый стиль и поведение компонентов
7. **Производительность**: оптимизированные переиспользуемые компоненты

## Рекомендации по дальнейшему развитию

1. **Создание виджетов**: для сложных композиций компонентов
2. **Добавление новых фич**: по аналогии с term-plan
3. **Улучшение shared компонентов**: добавление новых вариантов и настроек
4. **Документация**: создание Storybook для UI компонентов
5. **Тестирование**: добавление unit и integration тестов
6. **Темизация**: создание системы тем для компонентов
7. **Анимации**: добавление плавных переходов и анимаций

## Заключение

Рефакторинг успешно проведен в соответствии с принципами FSD. Архитектура проекта стала более чистой, поддерживаемой и масштабируемой. Код разделен на логические слои с четкими границами ответственности. Создана богатая библиотека переиспользуемых компонентов, которая значительно упрощает разработку новых фич и поддерживает единообразие интерфейса.
