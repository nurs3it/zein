# API Setup Guide

## üîß –¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –¥–ª—è **—É–º–Ω–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è** –º–µ–∂–¥—É –ø—Ä—è–º—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏ –∏ –ø—Ä–æ–∫—Å–∏.

### –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

- **Development**: –ü—Ä—è–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ API (`http://oneki.kz:8002/api`)
- **Production**: –ü—Ä–æ–∫—Å–∏ —á–µ—Ä–µ–∑ Next.js (`/api/proxy`)
- **Timeout**: 30 —Å–µ–∫—É–Ω–¥
- **Credentials**: –û—Ç–∫–ª—é—á–µ–Ω—ã

### üîí –†–µ—à–µ–Ω–∏–µ Mixed Content –ø—Ä–æ–±–ª–µ–º

–í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è HTTPS –ø—Ä–æ–∫—Å–∏ –¥–ª—è —Ä–µ—à–µ–Ω–∏—è Mixed Content –æ—à–∏–±–æ–∫:

- –§—Ä–æ–Ω—Ç–µ–Ω–¥ (HTTPS) ‚Üí Next.js API Route (HTTPS) ‚Üí Backend (HTTP)
- –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–æ—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ `/api/proxy/[...path]`
- –ù–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–µ

## üåê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### Environment –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env.local` –¥–ª—è –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è URL (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):

```bash
# URL –±—ç–∫–µ–Ω–¥–∞ (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ø—Ä–æ–∫—Å–∏ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)
BACKEND_URL=http://oneki.kz:8002/api

# URL –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –≤ development —Ä–µ–∂–∏–º–µ
NEXT_PUBLIC_API_URL=http://oneki.kz:8002/api

# –†–µ–∂–∏–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
NODE_ENV=development
```

**–í–∞–∂–Ω–æ**:

- `BACKEND_URL` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–µ—Ä–≤–µ—Ä–æ–º Next.js –¥–ª—è –ø—Ä–æ–∫—Å–∏ –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
- `NEXT_PUBLIC_API_URL` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±—Ä–∞—É–∑–µ—Ä–æ–º –≤ development —Ä–µ–∂–∏–º–µ

## üö´ –†–µ—à–µ–Ω–∏–µ CORS –ø—Ä–æ–±–ª–µ–º

### –ù–∞ —Å—Ç–æ—Ä–æ–Ω–µ —Å–µ—Ä–≤–µ—Ä–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–î–æ–±–∞–≤—å—Ç–µ –≤ –≤–∞—à Django/FastAPI —Å–µ—Ä–≤–µ—Ä:

```python
# Django
CORS_ALLOW_ALL_ORIGINS = True
CORS_ALLOWED_ORIGINS = [
    "http://localhost:3000",
    "https://your-domain.com",
]

# FastAPI
from fastapi.middleware.cors import CORSMiddleware

app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:3000"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

## üîç –û—Ç–ª–∞–¥–∫–∞

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ ApiDebug

–í development —Ä–µ–∂–∏–º–µ –¥–æ—Å—Ç—É–ø–µ–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç ApiDebug (–ª–µ–≤—ã–π –Ω–∏–∂–Ω–∏–π —É–≥–æ–ª):

- **–¢–µ—Å—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è**: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API
- **–í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞**: –ò–∑–º–µ—Ä–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏
- **–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–æ–∫**: –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í—Å–µ API –∑–∞–ø—Ä–æ—Å—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞:

```bash
[API] GET /health { baseURL: "http://oneki.kz:8002/api", headers: {...} }
[API] Response 200: { status: "ok" }
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
src/
‚îú‚îÄ‚îÄ shared/config/
‚îÇ   ‚îú‚îÄ‚îÄ api-config.ts       # –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è API
‚îÇ   ‚îî‚îÄ‚îÄ axios.ts            # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ axios –∫–ª–∏–µ–Ω—Ç–∞
‚îî‚îÄ‚îÄ widgets/dev-tools/
    ‚îî‚îÄ‚îÄ ui/api-debug.tsx    # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ API
```

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

1. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ `http://oneki.kz:8002`
2. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ `http://localhost:3000`
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ ApiDebug –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏

## üîß –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### Mixed Content –æ—à–∏–±–∫–∏ (HTTPS/HTTP)

‚úÖ **–†–µ—à–µ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**: –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–æ–∫—Å–∏

- –§—Ä–æ–Ω—Ç–µ–Ω–¥ (HTTPS) –Ω–µ –º–æ–∂–µ—Ç –æ–±—Ä–∞—â–∞—Ç—å—Å—è –Ω–∞–ø—Ä—è–º—É—é –∫ HTTP API
- –ü—Ä–æ–∫—Å–∏ `/api/proxy/*` —Ä–µ—à–∞–µ—Ç —ç—Ç—É –ø—Ä–æ–±–ª–µ–º—É
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è

### CORS –æ—à–∏–±–∫–∏

- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ CORS –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ –¥–ª—è –¥–æ–º–µ–Ω–∞ `http://localhost:3000`
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ preflight –∑–∞–ø—Ä–æ—Å—ã (OPTIONS)

### –¢–∞–π–º–∞—É—Ç—ã

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞ `http://oneki.kz:8002`
- –£–≤–µ–ª–∏—á—å—Ç–µ timeout –≤ `api-config.ts` –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

### –ü—Ä–æ–±–ª–µ–º—ã –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Ç–æ–∫–µ–Ω—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ cookies
- –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –ø—Ä–∏–Ω–∏–º–∞–µ—Ç Bearer —Ç–æ–∫–µ–Ω—ã
